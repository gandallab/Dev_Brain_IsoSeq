{
  "hash": "994a410c0c47a05e0d15586d866b2a36",
  "result": {
    "markdown": "---\ntitle: \"Figure 5 - Marker Genes\"\nauthor: \"Ashok Patowary\"\nexecute:\n  cache: false\n  freeze: auto\neditor: source\neditor_options:\n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6      ✔ purrr   0.3.4 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.0      ✔ stringr 1.5.0 \n✔ readr   2.1.2      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(Seurat)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAttaching SeuratObject\nAttaching sp\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nisoT4k_filter = readRDS(\"data/working/isoT4k_filter.rds\")\nlevels(isoT4k_filter$orig.ident) = gsub(\"\\\\.\", \"-\", levels(isoT4k_filter$orig.ident)) # ExM.U becomes ExM-U\nisoT4k_filter\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAn object of class Seurat \n141112 features across 4167 samples within 2 assays \nActive assay: RNA (87162 features, 0 variable features)\n 1 other assay present: SCT\n 2 dimensional reductions calculated: pca, umap\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnew.cluster.ids <- c(\"ExM\", \"ExN-ExM\", \"ExM-U\", \"ExN-1\", \"ExN-2\", \"In\",\n                     \"vRG-ExN\", \"oRG\", \"IP\", \"ExDp\", \"ExN-3\", \"vRG\", \"PgS\", \"PgG2M\", \"Mic/Per/End\")\nnames(new.cluster.ids) <- levels(isoT4k_filter)\nisoT4k_filter <- RenameIdents(isoT4k_filter, new.cluster.ids)\nisoT4k_filter@meta.data$isoCellType <- Idents(isoT4k_filter)\nIdents(isoT4k_filter) <- isoT4k_filter$isoCellType\n```\n:::\n\n\n## Markers for isoform-based clustering\n\n\n::: {.cell}\n\n```{.r .cell-code}\nisoT4k_filter_1<- subset(isoT4k_filter, idents=c(\"ExM\", \"ExN-ExM\", \"ExM-U\", \"In\",\n                                                 \"oRG\", \"IP\", \"ExDp\",\"vRG\",\n                                                 \"ExN-1\", \"ExN-2\", \"ExN-3\"))\nmerged.markers.CT <- FindAllMarkers(isoT4k_filter_1, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.75)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExM\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExN-ExM\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in FindMarkers.default(object = data.use, slot = data.slot, counts =\ncounts, : No features pass logfc.threshold threshold; returning empty data.frame\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExM-U\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExN-1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExN-2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster In\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster oRG\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster IP\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExDp\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExN-3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster vRG\n```\n:::\n\n```{.r .cell-code}\nmerged.markers.CT.padj<- merged.markers.CT[merged.markers.CT$p_val_adj < 0.05,]\ntop.merged.markers.CT.padj<- merged.markers.CT.padj%>% group_by(cluster) %>% top_n(n = 3, wt = avg_log2FC)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_order<- c(\"vRG\", \"oRG\", \"IP\", \"vRG-ExN\", \"ExN-1\", \"ExN-2\", \"ExN-3\", \"ExN-ExM\", \"ExM\", \"ExM-U\",\"ExDp\", \"In\")\ntop.merged.markers.CT.padj$cluster<- factor( as.character(top.merged.markers.CT.padj$cluster), levels= new_order)\ntop.merged.markers.CT.padj<- top.merged.markers.CT.padj[order(top.merged.markers.CT.padj$cluster),]\nisoT4k_filter_1$isoCellType<- factor(isoT4k_filter_1$isoCellType, levels = c(\"vRG\", \"oRG\", \"IP\", \"vRG-ExN\", \"ExN-1\", \"ExN-2\", \"ExN-3\", \"ExN-ExM\", \"ExM\", \"ExM-U\", \"ExDp\", \"In\"))\nIdents(isoT4k_filter_1)<- isoT4k_filter_1$isoCellType\n\nmapal <- colorRampPalette(RColorBrewer::brewer.pal(9,\"Blues\"))(256)\n\nDoHeatmap(subset(isoT4k_filter_1, downsample = 113), group.by = 'isoCellType', features = top.merged.markers.CT.padj$gene, angle = 90, size = 3, disp.max = 7, disp.min=1.5) + \n          scale_fill_gradientn(colours = mapal) + theme(plot.margin = unit(c(0.75,0.25,0.25,0.25), \"cm\")) +theme(axis.text=element_text(size=10), legend.title = element_text(size = 8), legend.text = element_text(size = 6))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](Figure5_MarkerGenesFigs_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#ggsave(\"output/figures/Fig_4G.pdf\", device =\"pdf\", dpi=600, width =754, height = 704, scale = 1/100)\nggsave(\"output/figures/Fig5/Fig5_Markers_NewCellTypes.pdf\", width = 7, height = 7)\n```\n:::\n\n\n## Markers for gene-based clustering\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIdents(isoT4k_filter)<- isoT4k_filter$orig.ident\nhead(Idents(isoT4k_filter))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nEnd_ACGGCATAGTAC End_ACTGACTGATCC End_ACTGGCACCGAG End_AGCTAGCCCATG \n             End              End              End              End \nEnd_AGTTTAGCGGTC End_ATCCGACCATCA \n             End              End \n16 Levels: End ExDp1 ExDp2 ExM ExM-U ExN InCGE InMGE IP Mic OPC oRG ... vRG\n```\n:::\n\n```{.r .cell-code}\nisoT4k_filter_2<- subset(isoT4k_filter, idents=c(\"vRG\", \"oRG\", \"IP\", \"ExN\", \"ExM\", \"ExM-U\", \"ExDp1\", \"ExDp2\", \"InCGE\", \"InMGE\"))\nisoT4k_filter_2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAn object of class Seurat \n141112 features across 3912 samples within 2 assays \nActive assay: RNA (87162 features, 0 variable features)\n 1 other assay present: SCT\n 2 dimensional reductions calculated: pca, umap\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmerged.markers.CT <- FindAllMarkers(isoT4k_filter_2, only.pos = TRUE, min.pct = 0.15, logfc.threshold = 0.25)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExDp1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExDp2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExM\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExM-U\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster ExN\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster InCGE\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster InMGE\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster IP\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster oRG\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cluster vRG\n```\n:::\n\n```{.r .cell-code}\nmerged.markers.CT.padj<- merged.markers.CT[merged.markers.CT$p_val_adj < 0.05,]\ntop.merged.markers.CT.padj<- merged.markers.CT.padj%>% group_by(cluster) %>% top_n(n = 5, wt = avg_log2FC)\nmin(table(Idents(isoT4k_filter_2)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 14\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDoHeatmap(isoT4k_filter_2, features = top.merged.markers.CT.padj$gene, angle = 90, size = 3, disp.max = 7, disp.min=0.5) + scale_fill_gradientn(colours = mapal) + theme(plot.margin = unit(c(0.75,0.25,0.25,0.25), \"cm\")) +theme(axis.text=element_text(size=10), legend.title = element_text(size = 8), legend.text = element_text(size = 6))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](Figure5_MarkerGenesFigs_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#ggsave(\"Marker_oldCT_v3.pdf\", width = 7.54, height = 7.04)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nisoT4k_filter_2$orig.ident<- factor(isoT4k_filter_2$orig.ident, levels = c(\"vRG\", \"oRG\", \"IP\", \"ExN\", \"ExM\", \"ExM-U\", \"ExDp1\", \"ExDp2\", \"InCGE\", \"InMGE\"))\nnew_order<- c(\"vRG\", \"oRG\", \"IP\", \"ExN\", \"ExM\", \"ExM-U\", \"ExDp1\", \"ExDp2\", \"InCGE\", \"InMGE\")\ntop.merged.markers.CT.padj$cluster<- factor( as.character(top.merged.markers.CT.padj$cluster), levels= new_order)\ntop.merged.markers.CT.padj<- top.merged.markers.CT.padj[order(top.merged.markers.CT.padj$cluster),]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDoHeatmap(subset(isoT4k_filter_2, downsample = 200), features = top.merged.markers.CT.padj$gene, angle = 90, size = 3, disp.max = 7.5, disp.min=1.5) + scale_fill_gradientn(colours = mapal) + theme(plot.margin = unit(c(0.75,0.25,0.25,0.25), \"cm\")) +theme(axis.text=element_text(size=10), legend.title = element_text(size = 8), legend.text = element_text(size = 6))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](Figure5_MarkerGenesFigs_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#ggsave(\"Marker_oldCT_v3.pdf\", width = 7.54, height = 9.5)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nIdents(isoT4k_filter_2)<- isoT4k_filter_2$orig.ident\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDoHeatmap(subset(isoT4k_filter_2, downsample = 200), features = top.merged.markers.CT.padj$gene, angle = 90, size = 3, disp.max = 7.5, disp.min=1.5) + scale_fill_gradientn(colours = mapal) + theme(plot.margin = unit(c(0.75,0.25,0.25,0.25), \"cm\")) +theme(axis.text=element_text(size=10), legend.title = element_text(size = 8), legend.text = element_text(size = 6))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for 'fill' is already present. Adding another scale for 'fill', which\nwill replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](Figure5_MarkerGenesFigs_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#ggsave(\"Marker_oldCT_v3.pdf\", device =\"pdf\", dpi=600, width =794, height = 970, scale = 1/100)\nggsave(\"output/figures/Fig5/Fig5_Markers_oldCellTypes.pdf\", width = 7.94, height = 9.70)\n```\n:::\n",
    "supporting": [
      "Figure5_MarkerGenesFigs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}